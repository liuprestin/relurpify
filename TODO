End-to-End Testing Plan

Pre‑flight setup

Install/build dependencies: Go 1.21+, rust-analyzer, Ollama with target model (e.g., codellama), and any project-specific toolchain (cargo, git).
Ensure a clean workspace clone with test fixture project(s) (e.g., a sample Rust repo under testdata/rustapp).
Start Ollama (ollama serve or equivalent) and verify curl http://localhost:11434/api/tags succeeds.
Language server validation

Launch rust-analyzer manually with --version to confirm availability.
Use the CLI helper: go run ./cmd/relurpify lsp --lang rust --root testdata/rustapp --file src/lib.rs to check diagnostics/symbol responses. This ensures tools.NewRustAnalyzerClient can connect and serve requests.
Framework server flow (relurpify CLI)

Start the API server: go run ./cmd/relurpify serve --workspace testdata/rustapp.
POST a task to /api/task via curl (instruction like “Describe the function foo in src/lib.rs” with context including file path/code). Expect JSON result and check logs for telemetry.
Exercise CLI utilities:
relurpify task --instruction "summarize src/lib.rs" --context testdata/context.json.
relurpify workflow list (should show none initially) after a serve run.
relurpify memory search project "foo" to confirm cache persistence.
Kill server and restart to confirm hybrid memory/lsp state survive across runs.
Coding CLI flow (relurpify-coder)

Prepare a target file in testdata/rustapp/src/lib.rs.
Run go run ./cmd/coder apply -f src/lib.rs -i "add error logging" --workspace testdata/rustapp.
Verify:
CLI prints final summary, result data, and any tests run.
File modifications occur only where expected (use git diff in the fixture repo).
LSP-backed tools were invoked (look for rust-analyzer process logs or telemetry).
Repeat with --lang rust override and with auto-detection to cover both paths.
Introduce a deliberate syntax error, rerun apply, and confirm diagnostics are surfaced.
State persistence & telemetry

While server is running, trigger tasks that pause/resume (e.g., manual snapshot). Use relurpify workflow list/show to inspect stored snapshots and ensure persistence.FileWorkflowStore entries look correct.
Check .memory directory contents before/after tasks to ensure HybridMemory is updating.
Enable telemetry logging by setting graph.SetTelemetry(LoggerTelemetry{}) in a test harness and verify start/finish/error events appear in logs when running sample tasks.
Documentation & CLI smoke tests

Run relurpify docs --out tmpdocs and open tmpdocs/index.html to ensure Golds generation still works.
go run ./cmd/relurpify --help and go run ./cmd/coder --help to confirm commands/flags parse correctly.
Optional: script these in a shell test (bash scripts/e2e.sh) that sets GOCACHE/GOMODCACHE, starts the server, runs the task, and asserts exit codes.
Regression checks

Final go test ./... (already part of CI) and golangci-lint if available.
Use a matrix (Rust project only for now) but plan future expansions (Go, Python) by swapping the LSP descriptor in the CLI tests.
This plan exercises the full stack—Ollama, rust-analyzer, both CLIs, persistence, and LSP tooling—mirroring real-world usage.
